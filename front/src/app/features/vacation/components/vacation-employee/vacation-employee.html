<div class="page-container">
  <div class="page-content">
    <div class="row">
      <!-- Left Side: Vacation Requests Table -->
      <div class="col-lg-8">
        <div class="vacation-requests-section">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="section-header mb-0">My Vacation Requests</h2>
          </div>

          @if (isLoadingVacations()) {
            <p>Loading vacation requests...</p>
          } @else if (vacationRequests()) {
            @if (vacationRequests()!.content.length === 0) {
              <div class="no-requests">
                <p>No vacation requests found.</p>
              </div>
            } @else {
              <app-data-table
                [data]="vacationRequests()!"
                [config]="vacationTableConfig"
                (action)="onTableAction($event)"
              />
            }
          } @else {
            <div class="no-requests">
              <p>No vacation requests found.</p>
            </div>
          }
        </div>
      </div>

      <!-- Right Side: New Vacation Request Form -->
      <div class="col-lg-4">
        <div class="vacation-request-form">
          <h3 class="section-header">New Vacation Request</h3>

          <form [formGroup]="vacationForm" (ngSubmit)="submitForm()">
            <!-- Date Range Picker -->
            <div class="mb-3">
              <label class="form-label">Vacation Period</label>

              <!-- Hidden datepicker for range selection -->
              <div class="dp-hidden position-absolute">
                <div class="input-group">
                  <input
                    name="datepicker"
                    class="form-control"
                    ngbDatepicker
                    #datepicker="ngbDatepicker"
                    [autoClose]="'outside'"
                    (dateSelect)="onDateSelection($event)"
                    [displayMonths]="2"
                    [dayTemplate]="t"
                    outsideDays="hidden"
                    [startDate]="fromDate!"
                    tabindex="-1"
                  />
                  <ng-template #t let-date let-focused="focused">
                    <span
                      class="custom-day"
                      [class.focused]="focused"
                      [class.range]="isRange(date)"
                      [class.faded]="isHovered(date) || isInside(date)"
                      (mouseenter)="hoveredDate = date"
                      (mouseleave)="hoveredDate = null"
                    >
                      {{ date.day }}
                    </span>
                  </ng-template>
                </div>
              </div>

              <!-- From Date Input -->
              <div class="input-group mb-2">
                <input
                  #dpFromDate
                  class="form-control"
                  placeholder="yyyy-mm-dd"
                  name="dpFromDate"
                  [value]="formatter.format(fromDate)"
                  (input)="fromDate = validateInput(fromDate, dpFromDate.value)"
                />
                <button class="btn btn-outline-secondary" (click)="datepicker.toggle()" type="button">ðŸ“…</button>
              </div>

              <!-- To Date Input -->
              <div class="input-group">
                <input
                  #dpToDate
                  class="form-control"
                  placeholder="yyyy-mm-dd"
                  name="dpToDate"
                  [value]="formatter.format(toDate)"
                  (input)="toDate = validateInput(toDate, dpToDate.value)"
                />
                <button class="btn btn-outline-secondary" (click)="datepicker.toggle()" type="button">ðŸ“…</button>
              </div>

              @if (fromDate || toDate) {
                <div class="mt-2 text-muted">
                  @if (fromDate && toDate) {
                    <small>Selected: {{ formatDate(fromDate) }} - {{ formatDate(toDate) }}</small>
                  } @else if (fromDate) {
                    <small>Start date: {{ formatDate(fromDate) }}</small>
                  }
                </div>
              }
            </div>

            <!-- Form Actions -->
            <div class="d-flex gap-2">
              <button
                type="submit"
                class="btn btn-primary flex-grow-1"
                [disabled]="!isFormValid() || isSubmitting()">
                @if (isSubmitting()) {
                  <span class="spinner-border spinner-border-sm me-2"></span>
                }
                Submit Request
              </button>

              <button type="button" class="btn btn-outline-secondary" (click)="resetForm()">
                Clear
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<ng-template #deleteModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title">Confirm Delete</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    @if (deletingVacation) {
      <p>Are you sure you want to delete this vacation request?</p>
      <ul class="mb-0">
        <li><strong>Start Date:</strong> {{ deletingVacation.startDate }}</li>
        <li><strong>End Date:</strong> {{ deletingVacation.endDate }}</li>
        <li><strong>Status:</strong> {{ deletingVacation.status }}</li>
      </ul>
      <p class="text-muted mt-2">This action cannot be undone.</p>
    }
  </div>
  <div class="modal-footer d-flex justify-content-between">
    <button type="button" class="btn btn-outline-primary" (click)="modal.dismiss()">Cancel</button>
    <button type="button" class="btn btn-danger" (click)="deleteVacationRequest(); modal.close()">Delete</button>
  </div>
</ng-template>
